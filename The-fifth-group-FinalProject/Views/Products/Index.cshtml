<div id="app">
    <div class="container-fluid mt-3">
        <div class="row">
            <div class="col-lg-3">
                <h5 class="mb-3">搜尋產品</h5>
                <div class="form-group">
                    <label for="keyword">關鍵字:</label>
                    <input type="text" class="form-control" v-model="keyword" v-on:input="searchProducts">
                </div>
                <div class="form-group">
                    <label for="brand">品牌:</label>
                    <select class="form-control" v-model="selectedBrand" v-on:change="searchProducts">
                        <option value="">全部</option>
                        <option v-for="brand in brands" :key="brand" :value="brand">{{ brand }}</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="color">顏色:</label>
                    <select class="form-control" v-model="selectedColor" v-on:change="searchProducts">
                        <option value="">全部</option>
                        <option v-for="color in colors" :key="color" :value="color">{{ color }}</option>
                    </select>
                </div>
            </div>
            <div class="col-lg-9">
                <h5 class="mb-3">商品清單</h5>
                <div class="row">
                    <div class="col-md-4 mb-3" v-for="product in products" :key="product.id">
                        <div class="card h-100">
                            <img class="card-img-top" :src="product.imageUrl" alt="Card image cap">
                            <div class="card-body">
                                <h4 class="card-title">{{ product.productName }}</h4>
                                <p class="card-text">{{ product.brand }} - {{ product.color }}</p>
                                <h5 class="card-text">{{ product.price }}元</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



@section Scripts{
    <script src="https://unpkg.com/vue@3.2.29/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.3/axios.min.js"></script>
    <script>
        var webApiBaseAddress = "https://localhost:7040";

        const app = Vue.createApp({
            data() {
                return {
                    selectedBrand: '',
                    selectedColor: '',
                    keyword: '',
                    brands: [],
                    colors: [],
                    products: []
                }
            },
            async mounted() {
                await this.searchProducts()
                await this.getBrands()
                await this.getColors()
            },
            methods: {
                async getBrands() {
                    try {
                        const response = await axios.get('https://localhost:7040/api/brands')
                        response.data.forEach(element=> {
                            this.brands.push(element.brand)
                        })
                        //this.brands = [''].concat(response.data.map(brand => brand.brand))
                    } catch (error) {
                        console.error(error)
                    }
                },
                async getColors() {
                    try {
                        const response = await axios.get('https://localhost:7040/api/colors')
                        response.data.forEach(element => {
                            this.colors.push(element.color)
                        })
                    } catch (error) {
                        console.error(error)
                    }
                },
                async searchProducts() {
                    try {
                        const response = await axios.get('https://localhost:7040/api/products', {
                            params: {
                                brand: this.selectedBrand,
                                color: this.selectedColor,
                                keyword: this.keyword
                            }
                        })
                        this.products = response.data
                    } catch (error) {
                        console.error(error)
                    }
                }
            }
        })

        app.mount('#app')

    </script>
}
