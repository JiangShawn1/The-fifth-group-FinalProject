<div id="app" class="container">
	<h1>商品列表</h1>
	<ul>
		<li v-for="item in items" :key="item.id">
			{{ item.productName }} 價錢 {{ item.price }} 數量{{item.qty}}
		</li>
	</ul>
	<div class="card mb-3">
		<div class="row g-0">
			<div class="col-md-6">
				<img :src="commodity.imageUrl" alt="product image" class="img-fluid" style="max-width: 700px; height: 100%;">
			</div>
			<div class="col-md-6">
				<div class="card-body">
					<h2>{{ commodity.productName }}</h2>
					<p>品牌: {{ commodity.brand }}</p>
					<p>顏色: {{ commodity.color }}</p>
					<p>價錢: {{ commodity.price }}</p>
					<button class="btn btn-primary" @@click="insert">Add to Cart</button>
				</div>
			</div>
		</div>
	</div>
	<div class="card p-3">
		<p>產品介紹:{{ commodity.productIntroduce }}</p>
	</div>
</div>

@section Scripts{
	<script src="https://unpkg.com/vue@3.2.29/dist/vue.global.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.3/axios.min.js"></script>
	<script>
		var webApiBaseAddress = "https://localhost:7040";

		const app = Vue.createApp({
			data() {
				return {
					commodity: {},
					items: [],
					memberId: 3,
					qty: 2,
				};
			},
			mounted() {
				var id = location.hash.split('#')[1];
				axios
					.get(`${webApiBaseAddress}/api/Products/${id}`)
					.then((response) => {
						this.commodity = response.data;
					})
					.catch((error) => {
						console.log(error);
					});
				axios.get(`${webApiBaseAddress}/api/CartItems/3`)
					.then(response => {
						this.items = response.data
					})
					.catch(error => {
						console.log(error)
					});
			},
			methods: {
				insert: function () {
					var _this = this;
					var cartlist = {};
					cartlist.memberId = _this.memberId;
					cartlist.productId = _this.commodity.id;
					cartlist.qty = _this.qty;
					console.log(cartlist);
					axios.post(`${webApiBaseAddress}/api/CartItems?memberId=${this.memberId}&productId=${cartlist.productId}&qty=${cartlist.qty}`)
						.then(response => {
							axios.get(`${webApiBaseAddress}/api/CartItems/3`)
								.then(response => {
									_this.items = response.data;
								})
								.catch(error => {
									console.log(error);
								});
							window.location = (`/products/commodity/#${cartlist.productId}`);
						})
						.catch(error => {
							console.log(error);
						});
				}



			}
		});

		app.mount('#app');
	</script>
}
