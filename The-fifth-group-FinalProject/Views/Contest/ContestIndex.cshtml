@section Styles{
	<style>
	.event-item {
    position: relative;
    display: inline-block;
    font-size: .8125em;
    color: #191823;
	background-color: #E0E0E0;
    padding: 4px 6px;
    margin: 3px;
    border-radius: 3px;
    }
	.event-item:hover {
	color: white;
	background-color: black;
	}	
	.myMOUSE{ 
	cursor: pointer;
	color:black;
	text-decoration:none	
	}
	.myMOUSE:hover {
	color:black;
	}
	</style>
}
<div id="app">		
	@*篩選*@
	<div class="row" style="width:50%;margin-left:auto;margin-right:5px">
		<label class="col-lg-3">請輸入地區或活動名稱</label>
		<input class="col-lg-7 form-control m-1" v-model="Filter" placeholder="請輸入地區或活動名稱" />
		<button class="btn btn-outline-primary" @@click="filterContestsDTOs">篩選</button>
	</div>


	<button type="button" class="btn btn-success">新增賽事</button>
	<div class="row">
		<div class="col-12 mt-4">
			<table class="table table-striped  table-hover">
				<thead>
					<tr>
						<td>活動日期</td>
						<td>地區</td>
						<td>賽事/活動	</td>
						<td>項目</td>
						<td>活動狀態</td>
					</tr>
				</thead>
				<tbody>
					<tr v-for="item in ContestsDTOes" >
						<td>{{item.contestDateString}}</td>
						<td>{{item.area}}</td>
						<td ><a class="myMOUSE" @@click="selectContest(item.id)">{{item.name}}</a></td>
						<td><span class="event-item" v-for="d in item.distance"> {{d}}K </span> </td>
						<td>{{item.status}}</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

</div>
@section Scripts
	{
	<script src="https://unpkg.com/vue@3.2.29/dist/vue.global.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.3/axios.min.js"></script>
	<script>
		var webApiBaseAddress = "https://localhost:7040";
		var vueApp = {
			data() {
				return {
					Filter: "",
					ContestsDTOes:[],
				};
			},
			mounted: function () {
				let _this = this;
				_this.getContestsDTOes();
			},
			methods: {
				getContestsDTOes: function () {
					let _this = this;
					axios.get(`${webApiBaseAddress}/api/Contests`).then(response => {
						_this.ContestsDTOes = response.data;
						for (var i = 0; i < _this.ContestsDTOes.length; i++)
						{	
							_this.ContestsDTOes[i]['contestDateString']=_this.ContestsDTOes[i].contestDate.substr(0, 10);
							var today = new Date();
							var DeadlineString = _this.ContestsDTOes[i].registrationDeadline.substr(0, 10);
							var registrationDeadline = new Date(DeadlineString);
							if (registrationDeadline > today)
							{
								_this.ContestsDTOes[i]['status'] = `報名中,${DeadlineString}截止`;
							}
							else 
							{								
								_this.ContestsDTOes[i]['status'] = "已截止報名";
						    }
						};
						_this.ContestsDTOes = _this.ContestsDTOes.sort((a, b) => new Date(a.contestDate) - new Date(b.contestDate));
					});
				},

				selectContest: function (id) {
					window.location = `ContestDetail/#${id}`;
				},	
				
				filterContestsDTOs: function () {
					let _this = this;
					var request = {};
					request.Name = _this.Filter;					
					axios.post(`${webApiBaseAddress}/api/Contests/Filter`, request).then(response => {
						_this.ContestsDTOes = response.data;
						for (var i = 0; i < _this.ContestsDTOes.length; i++) {
							_this.ContestsDTOes[i]['contestDateString'] = _this.ContestsDTOes[i].contestDate.substr(0, 10);
							var today = new Date();
							var DeadlineString = _this.ContestsDTOes[i].registrationDeadline.substr(0, 10);
							var registrationDeadline = new Date(DeadlineString);
							if (registrationDeadline > today) {
								_this.ContestsDTOes[i]['status'] = `報名中,${DeadlineString}截止`;
							}
							else {
								_this.ContestsDTOes[i]['status'] = "已截止報名";
							}
						};
						_this.ContestsDTOes = _this.ContestsDTOes.sort((a, b) => new Date(a.contestDate) - new Date(b.contestDate));
					});
				},
			},
		};
		var app = Vue.createApp(vueApp).mount("#app");

	</script>
}