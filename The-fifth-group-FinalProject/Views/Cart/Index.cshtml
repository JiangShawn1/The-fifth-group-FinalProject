<style>
    .progressbar {
        counter-reset: step;
    }

        .progressbar li {
            list-style-type: none;
            width: 25%;
            float: left;
            font-size: 12px;
            position: relative;
            text-align: center;
            text-transform: uppercase;
            color: #7d7d7d;
        }

            .progressbar li:before {
                width: 30px;
                height: 30px;
                content: counter(step);
                counter-increment: step;
                line-height: 30px;
                border: 2px solid #7d7d7d;
                display: block;
                text-align: center;
                margin: 0 auto 10px auto;
                border-radius: 50%;
                background-color: white;
            }

            .progressbar li:after {
                width: 100%;
                height: 2px;
                content: '';
                position: absolute;
                background-color: #7d7d7d;
                top: 15px;
                left: -50%;
                z-index: -1;
            }

            .progressbar li:first-child:after {
                content: none;
            }

            .progressbar li.active {
                color: green;
            }

                .progressbar li.active:before {
                    border-color: #55b776;
                }

                .progressbar li.active + li:after {
                    background-color: #55b776;
                }
</style>

<div id="app" >
    <div class="mt-5">
        <ul class="progressbar">
            <li :class="{ active: step === 1 }">購物車</li>
            <li :class="{ active: step === 2 }">訂單資料</li>
            <li :class="{ active: step === 3 }">建立訂單</li>
            <li :class="{ active: step === 4 }">付款</li>
        </ul>
    </div>

    <div class="card shadow rounded">
        <h5 class="card-header">購物車</h5>
        <div class="card-body">
            <template v-if="cartItems.length > 0">
                <table class="table">
                    <thead class="table-borderless">
                        <tr>
                            <th></th>
                            <th>商品名稱</th>
                            <th>單價</th>
                            <th>數量</th>
                            <th>小計</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item, index) in cartItems" :key="index">
                            <td class="text-center">
                                <img :src="item.imageUrl" height="30" />
                            </td>
                            <td>{{ item.productName }}</td>
                            <td>{{ item.price }}</td>
                            <td>{{ item.qty }}</td>
                            <td>{{ item.subtotal }}</td>
                            <!-- <td>
                              <a class="btn btn-sm btn-danger" @@click="removeItem(index)">Delete</a>
                            </td> -->
                        </tr>
                    </tbody>
                </table>
            </template>
            <p v-else class="text-center text-dark">購物車內尚無商品</p>
            <hr />
            <div class="row">
                <div class="col-4 justify-content-around">
                    <div class="input-group input-group-sm mb-2">
                        <span style="padding-top:3px">優惠碼：</span>
                        <input type="text" class="form-control" placeholder="coupon" name="coupon" v-model="coupon" />
                    </div>
                </div>
                <div class="col text-right pr-5">
                    <h5>總計： ${{ total }}</h5>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-3 d-flex">
        <a class="btn btn-secondary mx-2 active" role="button" aria-pressed="true" asp-controller="Products" asp-action="Index">繼續購物</a>
        <a class="btn btn-primary mx-2 active" role="button" aria-pressed="true" asp-controller="Orders" asp-action="Checkout">前往結帳</a>
    </div>
</div>



@section Scripts
    {
    <script src="https://unpkg.com/vue@3.2.29/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.3/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/3.0.1/js.cookie.min.js"></script>
    <script>
        var webApiBaseAddress = "https://localhost:7040";
        var vueApp = {
            data() {
                return {
                    step: 1,
                    cartItems: [],
                    coupon: '',
                    total: 0,
                }
            },
            mounted: function () {
                let _this = this;
                // _this.checkLogin();
                _this.getAllOrders();
            },
            methods: {
                getAllOrders: function () {
                    let _this = this;
                    let memberId = Cookies.get('MemberId');
                    axios.get(`${webApiBaseAddress}/api/CartItems/3`).then(
                        res => {
                            console.log(res.data);
                            _this.cartItems = res.data;
                            var cartItemsList = [];
                            var result = 0;
                            for (var i = 0; i < _this.cartItems.length; i++) {
                                var item = {};
                                item = _this.cartItems[i];
                                item.subtotal = item.qty * item.price;
                                cartItemsList.push(item);
                                result += item.subtotal
                            }
                            _this.cartItems = cartItemsList;
                            _this.total = result;
                        }
                    );
                },
                checkLogin: function () {
                    let memberId = Cookies.get('MemberId');
                    if (!memberId > 0) {
                        alert("請先進行登入")
                        window.location = "/home/Login";
                    }
                },
            }
        }
        var app = Vue.createApp(vueApp).mount("#app");
    </script>
}
